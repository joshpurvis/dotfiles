---
- name: gcloud | sdk repo
  become: no
  shell: echo "cloud-sdk-$(lsb_release -c -s)"
  register: cloud_sdk_repo
  tags:
    - gcloud

- debug: var=cloud_sdk_repo
  tags:
    - gcloud

- name: gcloud | add cloud sdk repo
  become: yes
  shell: echo "deb https://packages.cloud.google.com/apt {{ cloud_sdk_repo.stdout }} main" > /etc/apt/sources.list.d/google-cloud-sdk.list
  tags:
    - gcloud

- name: add apt repo key
  become: yes
  apt_key:
    url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
    state: present
  tags:
    - gcloud

- name: install cloud sdk
  become: yes
  apt:
    name: google-cloud-sdk
    state: present
    update_cache: yes
  tags:
    - gcloud